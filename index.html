<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOUPA // SECURE_TITAN_v12.5</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700;900&family=JetBrains+Mono:wght@100;400;700&family=Inter:wght@200;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #010101;
            --surface: #080808;
            --elevated: #111;
            --accent: #ff5500;
            --accent-soft: rgba(255, 85, 0, 0.15);
            --text-main: #ffffff;
            --text-dim: #555555;
            --success: #00ffaa;
            --border: rgba(255, 255, 255, 0.05);
            --font-mono: 'JetBrains Mono', monospace;
            --ease: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; cursor: none !important; }
        body { background: var(--bg); color: var(--text-main); font-family: 'Inter', sans-serif; overflow-x: hidden; }

        /* --- VISUAL ENGINE --- */
        #bg-canvas { position: fixed; inset: 0; z-index: -1; }
        .vignette { position: fixed; inset: 0; pointer-events: none; z-index: 50; background: radial-gradient(circle, transparent 40%, #000 130%); }

        /* --- COOKIE SHIELD --- */
        #cookie-shield {
            position: fixed; bottom: 30px; right: 30px; width: 380px;
            background: var(--surface); border: 1px solid var(--accent);
            padding: 30px; z-index: 10000; display: none;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
        }
        #cookie-shield h4 { font-family: var(--font-mono); color: var(--accent); margin-bottom: 15px; font-size: 0.8rem; }
        #cookie-shield p { font-size: 0.75rem; color: var(--text-dim); line-height: 1.6; margin-bottom: 20px; }

        /* --- GLOBAL CHAT --- */
        #chat-sys {
            position: fixed; bottom: 30px; left: 30px; width: 320px; height: 400px;
            background: rgba(5,5,5,0.9); border: 1px solid var(--border);
            z-index: 2000; display: flex; flex-direction: column; backdrop-filter: blur(15px);
        }
        #chat-head { padding: 12px; border-bottom: 1px solid var(--border); font-family: var(--font-mono); font-size: 0.6rem; display: flex; justify-content: space-between; }
        #chat-content { flex: 1; overflow-y: auto; padding: 15px; font-family: var(--font-mono); font-size: 0.65rem; }
        .msg { margin-bottom: 8px; border-left: 1px solid var(--accent); padding-left: 10px; }
        .msg span { color: var(--accent); font-weight: 700; }
        #chat-bar { border-top: 1px solid var(--border); display: flex; }
        #chat-bar input { background: transparent; border: none; color: #fff; padding: 12px; flex: 1; outline: none; font-size: 0.7rem; font-family: var(--font-mono); }

        /* --- UI COMPONENTS --- */
        nav {
            position: fixed; top: 0; width: 100%; height: 80px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 6%; z-index: 3000; border-bottom: 1px solid var(--border);
            backdrop-filter: blur(25px);
        }
        .brand { font-family: 'Space Grotesk'; font-size: 1.8rem; font-weight: 900; letter-spacing: -2px; }
        .brand span { color: var(--accent); }

        .container { width: 88%; max-width: 1400px; margin: 0 auto; }
        .btn {
            background: var(--accent); border: 1px solid var(--accent); color: #000;
            padding: 15px 30px; font-family: var(--font-mono); font-size: 0.65rem;
            font-weight: 700; text-transform: uppercase; transition: 0.4s;
        }
        .btn:hover { background: #fff; border-color: #fff; transform: translateY(-3px); }
        .btn-outline { background: transparent; color: #fff; border-color: var(--border); }

        /* --- REVIEWS --- */
        .rev-section { padding: 150px 0; background: #030303; }
        .rev-header { display: flex; align-items: flex-end; gap: 50px; margin-bottom: 80px; }
        .rev-avg { font-size: 7rem; font-family: 'Space Grotesk'; font-weight: 900; line-height: 1; }
        .rev-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .rev-card { background: var(--surface); padding: 40px; border: 1px solid var(--border); transition: 0.3s; }
        .rev-card:hover { border-color: var(--accent); }
        
        /* --- PRIVACY MODULE --- */
        .legal-footer { padding: 80px 0; border-top: 1px solid var(--border); }
        .legal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 100px; }
        .legal-item h5 { font-family: var(--font-mono); color: var(--accent); margin-bottom: 20px; font-size: 0.7rem; }
        .legal-item p { color: var(--text-dim); font-size: 0.85rem; line-height: 1.8; }

        /* --- CURSOR --- */
        #c-dot { position: fixed; width: 6px; height: 6px; background: #fff; border-radius: 50%; pointer-events: none; z-index: 20000; }
        #c-ring { position: fixed; width: 40px; height: 40px; border: 1px solid var(--accent); border-radius: 50%; pointer-events: none; z-index: 19999; transition: 0.15s; }

        .reveal { opacity: 0; transform: translateY(40px); transition: 1.2s var(--ease); }
        .reveal.active { opacity: 1; transform: translateY(0); }

        @media (max-width: 768px) { .legal-grid { grid-template-columns: 1fr; } #chat-sys { display: none; } }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="vignette"></div>
    <div id="c-dot"></div>
    <div id="c-ring"></div>

    <div id="cookie-shield">
        <h4>SECURE_COOKIE_HANDSHAKE</h4>
        <p>This node uses encrypted cookies to optimize session stability and reinforce protocol security. By proceeding, you accept our data-handling logic.</p>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="padding: 10px 20px;" onclick="Loupa.secure.acceptCookies()">ACCEPT_PROTOCOLS</button>
            <button class="btn btn-outline" style="padding: 10px 20px;" onclick="Loupa.secure.acceptCookies()">DECLINE</button>
        </div>
    </div>

    <div id="auth-gate" style="position:fixed; inset:0; background:#000; z-index:9000; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h1 class="brand" style="font-size: 5rem; margin-bottom: 20px;">LOUPA<span>.</span></h1>
        <p class="mono" style="color:var(--text-dim); margin-bottom:40px;">// ACCESS_LEVEL_REQUIRED</p>
        <button onclick="Loupa.auth.init()" class="btn">INITIALIZE_LINK</button>
    </div>

    <div id="chat-sys">
        <div id="chat-head">
            <span>[ SYSTEM_COMMS ]</span>
            <span style="color:var(--success)">ONLINE</span>
        </div>
        <div id="chat-content"></div>
        <div id="chat-bar">
            <input type="text" id="chat-input" placeholder="Broadcast to peers..." maxlength="80">
        </div>
    </div>

    <nav>
        <div class="brand">LOUPA<span>.</span></div>
        <div class="mono" id="node-id" style="font-size:0.6rem; color:var(--text-dim);">AWAITING_IDENT_V12</div>
    </nav>

    <main id="app-root" style="display:none; margin-top:80px;">
        <section class="container" style="min-height:80vh; display:flex; flex-direction:column; justify-content:center;">
            <div class="reveal">
                <h1 style="font-size: clamp(3rem, 12vw, 8rem); font-family:'Space Grotesk'; font-weight:900; line-height:0.85;">SECURED<br><span style="color:var(--accent);">ASSETS.</span></h1>
                <p style="color:var(--text-dim); max-width:650px; margin-top:40px; line-height:1.8; font-size:1.1rem; border-left: 1px solid var(--accent); padding-left: 30px;">
                    Loupa provides professional-grade digital assets backed by a secure peer-to-peer ecosystem. Your data is encrypted, your sessions are private, and our results are verified by 750+ global nodes.
                </p>
            </div>
        </section>

        <section class="rev-section" id="reviews">
            <div class="container">
                <div class="rev-header reveal">
                    <div>
                        <div class="rev-avg" id="avg-val">4.3</div>
                        <div style="color:var(--accent); letter-spacing:8px; margin-top:10px;">★★★★☆</div>
                    </div>
                    <div>
                        <h2 class="mono" style="color:var(--accent); font-size:1.5rem;">PEER_VERIFIED_DATA</h2>
                        <p class="mono" id="vote-count" style="color:var(--text-dim); margin-top:10px;">752_VOTES_LOGGED</p>
                    </div>
                </div>

                <div class="rev-grid" id="rev-list"></div>

                <div class="reveal" style="margin-top:80px; background:var(--surface); padding:60px; border:1px solid var(--border);">
                    <h3 class="mono" style="margin-bottom:30px;">LOG_FEEDBACK</h3>
                    <div style="display:flex; gap:10px; margin-bottom:20px;" id="star-rank">
                        <span style="cursor:pointer; font-size:1.5rem; color:var(--accent);" data-v="1">★</span>
                        <span style="cursor:pointer; font-size:1.5rem; color:var(--accent);" data-v="2">★</span>
                        <span style="cursor:pointer; font-size:1.5rem; color:var(--accent);" data-v="3">★</span>
                        <span style="cursor:pointer; font-size:1.5rem; color:var(--accent);" data-v="4">★</span>
                        <span style="cursor:pointer; font-size:1.5rem; color:var(--text-dim);" data-v="5">★</span>
                    </div>
                    <textarea id="rev-input" style="width:100%; height:120px; background:#000; border:1px solid var(--border); color:#fff; padding:20px; outline:none; font-family:inherit; margin-bottom:30px;" placeholder="Describe your deployment experience..."></textarea>
                    <button class="btn" onclick="Loupa.reviews.post()">SUBMIT_PROTOCOL</button>
                </div>
            </div>
        </section>

        <section class="legal-footer">
            <div class="container legal-grid reveal">
                <div class="legal-item">
                    <h5>01 // PRIVACY_SHIELD</h5>
                    <p>Loupa Protocol prioritizes data sovereignty. All user interactions are processed through encrypted channels. We do not store plain-text passwords or identifiable metadata beyond session-essential cookies. Your digital footprint is purged upon node disconnection.</p>
                </div>
                <div class="legal-item">
                    <h5>02 // COOKIE_POLICY</h5>
                    <p>We utilize local storage and session-based cookies to maintain your authentication state and preferences. These are strictly functional and do not track off-platform activity. Security headers are enforced at the server level to prevent XSS and data-leakage.</p>
                </div>
            </div>
        </section>
    </main>

    <script>
    const Loupa = (() => {
        const fbConfig = {
            apiKey: "AIzaSyDwkqu_JpelnceEjwbdP76hzwQ1JMFI2D0",
            authDomain: "loupa-d2ca2.firebaseapp.com",
            projectId: "loupa-d2ca2",
            storageBucket: "loupa-d2ca2.firebasestorage.app",
            messagingSenderId: "1062889452519",
            appId: "1:1062889452519:web:a412e262ba0981d3c3c342"
        };
        firebase.initializeApp(fbConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let baseCount = 752;
        let baseSum = 752 * 4.3;

        // --- BACKGROUND ENGINE ---
        const Engine = {
            init() {
                this.c = document.getElementById('bg-canvas');
                this.ctx = this.c.getContext('2d');
                window.onresize = () => { this.c.width = window.innerWidth; this.c.height = window.innerHeight; };
                window.onresize();
                this.pts = Array.from({length:60}, () => ({x:Math.random()*this.c.width, y:Math.random()*this.c.height, s:Math.random()*2}));
                this.loop();
            },
            loop() {
                this.ctx.fillStyle = 'rgba(1,1,1,0.2)';
                this.ctx.fillRect(0,0,this.c.width,this.c.height);
                this.pts.forEach(p => {
                    p.y += p.s; if(p.y > this.c.height) p.y = -10;
                    this.ctx.fillStyle = 'rgba(255,85,0,0.3)';
                    this.ctx.fillRect(p.x, p.y, 1, 10);
                });
                requestAnimationFrame(() => this.loop());
            }
        };

        // --- SECURITY & COOKIES ---
        const Secure = {
            check() {
                if(!localStorage.getItem('loupa_consent')) {
                    setTimeout(() => { document.getElementById('cookie-shield').style.display = 'block'; }, 2000);
                }
            },
            acceptCookies() {
                localStorage.setItem('loupa_consent', 'true');
                document.getElementById('cookie-shield').style.display = 'none';
            }
        };

        // --- CHAT ---
        const Chat = {
            init() {
                db.collection("global_chat").orderBy("ts", "desc").limit(15).onSnapshot(snap => {
                    const cont = document.getElementById('chat-content');
                    cont.innerHTML = snap.docs.reverse().map(doc => {
                        const d = doc.data();
                        return `<div class="msg"><span>${d.user}:</span> ${d.text}</div>`;
                    }).join('');
                    cont.scrollTop = cont.scrollHeight;
                });

                document.getElementById('chat-input').onkeydown = e => {
                    if(e.key === 'Enter' && e.target.value.trim()) {
                        db.collection("global_chat").add({
                            user: auth.currentUser.displayName.split(' ')[0],
                            text: e.target.value,
                            ts: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        e.target.value = '';
                    }
                };
            }
        };

        // --- REVIEWS ---
        const Reviews = {
            stars: 4,
            init() {
                document.querySelectorAll('#star-rank span').forEach(s => {
                    s.onclick = () => {
                        this.stars = s.dataset.v;
                        document.querySelectorAll('#star-rank span').forEach(x => x.style.color = x.dataset.v <= this.stars ? 'var(--accent)' : 'var(--text-dim)');
                    };
                });

                db.collection("reviews").orderBy("ts", "desc").onSnapshot(snap => {
                    const list = document.getElementById('rev-list');
                    let currentSum = baseSum;
                    let currentCount = baseCount + snap.size;
                    
                    list.innerHTML = snap.docs.map(doc => {
                        const d = doc.data();
                        currentSum += parseInt(d.stars);
                        return `
                            <div class="rev-card">
                                <div class="mono" style="color:var(--accent); font-size:0.6rem; margin-bottom:15px;">CLIENT_NODE_${doc.id.substring(0,5)}</div>
                                <p style="font-size:0.9rem; line-height:1.6; color:var(--text-dim)">"${d.text}"</p>
                                <div style="color:var(--accent); margin-top:20px; font-size:0.7rem;">${"★".repeat(d.stars)}</div>
                            </div>
                        `;
                    }).join('');

                    document.getElementById('avg-val').innerText = (currentSum / currentCount).toFixed(1);
                    document.getElementById('vote-count').innerText = `${currentCount}_VOTES_LOGGED`;
                });
            },
            post() {
                const val = document.getElementById('rev-input').value;
                if(!val) return;
                db.collection("reviews").add({
                    user: auth.currentUser.displayName.toUpperCase(),
                    stars: this.stars,
                    text: val,
                    ts: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('rev-input').value = '';
            }
        };

        return {
            auth: {
                init() {
                    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(res => {
                        document.getElementById('auth-gate').style.display = 'none';
                        document.getElementById('app-root').style.display = 'block';
                        document.getElementById('node-id').innerText = `NODE_ID: ${res.user.displayName.toUpperCase()}`;
                        Chat.init();
                        Reviews.init();
                        Secure.check();
                    });
                }
            },
            secure: Secure,
            reviews: Reviews,
            ui: {
                init() {
                    const d = document.getElementById('c-dot'), r = document.getElementById('c-ring');
                    document.onmousemove = e => {
                        d.style.left = e.clientX + 'px'; d.style.top = e.clientY + 'px';
                        r.style.transform = `translate(${e.clientX-20}px, ${e.clientY-20}px)`;
                    };
                    const obs = new IntersectionObserver(es => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('active'); }));
                    document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
                }
            }
        };
    })();

    window.onload = () => { 
        Loupa.ui.init(); 
        Loupa.LoupaEngine = Loupa; // Global ref
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        
        let rain = Array.from({length: 100}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, v: Math.random()*5+2 }));
        
        function draw() {
            ctx.fillStyle = 'rgba(1,1,1,0.15)';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = 'rgba(255,85,0,0.15)';
            rain.forEach(r => {
                r.y += r.v; if(r.y > canvas.height) r.y = -20;
                ctx.fillRect(r.x, r.y, 1, 15);
            });
            requestAnimationFrame(draw);
        }
        draw();
    };
    </script>
</body>
</html>
